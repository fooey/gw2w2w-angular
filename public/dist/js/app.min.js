/*! grunt-uglify gw2w2w-angular - v0.0.1 - 2014-05-11 */


/*!
*
*	app
*
!*/
console.log(""),console.log("******************************"),console.log("*    Starting Application    *"),console.log("******************************"),console.log("");var gw2app=angular.module("gw2app",["ngRoute","ngAnimate"]);gw2app.config(["$routeProvider","$locationProvider",function(a,b){"use strict";b.html5Mode(!0),a.when("/",{redirectTo:"/en"}).when("/:lang",{templateUrl:"/partials/app",controller:"AppCtrl"}).when("/:lang/:worldSlug",{templateUrl:"/partials/app",controller:"AppCtrl"})}]),/*!
 *
 *	Filters
 *
 !*/
gw2app.filter("toArray",[function(){"use strict";return function(a){return angular.isObject(a)?_.map(a,function(a,b){return Object.defineProperty(a,"$key",{__proto__:null,value:b})}):a}}]),gw2app.filter("pieUrl",[function(){"use strict";return function(a,b,c){return b=b||60,c=c||2,a?"http://piely.net/"+a.join(",")+"?size="+b+"&strokeWidth="+c:void 0}}]),gw2app.filter("logFilter",["GW2DataSvc",function(a){"use strict";return function(b,c){if(angular.isUndefined(b)||angular.isUndefined(c))return b;var d=[],e=[];return angular.forEach(b,function(a){(c.captures&&"newOwner"===a.type||c.claims&&"newClaimer"===a.type)&&d.push(a)}),angular.forEach(d,function(b){!a.wvw.mapObjectives[b.objective.id]||"all"!==c.map&&c.map!==a.wvw.mapObjectives[b.objective.id].mapName||e.push(b)}),e}}]),/*!
 *
 *	Services - CacheSvc
 *
 !*/
angular.module("gw2app").service("MemCacheSvc",["$timeout",function(a){"use strict";var b={},c={};return b.put=function(d,e,f,g,h){angular.isDefined(c[d])&&a.cancel(c[d].timeout);var i=angular.isNumber(f)?f+Date.now():null,j={value:e,expire:i};angular.isNumber(i)&&(g=(g||angular.noop).bind(null,d),j.timeout=a(b.del.bind(null,d,g),f)),h(null,c[d]=j)},b.get=function(a,d){var e=c[a];e?!angular.isNumber(e.expire)||e.expire>=Date.now()?d(null,e.value):b.del(a,d):d(null)},b.del=function(a,b){b(null,delete c[a])},b.clear=function(a){a(null,c={})},b.clearTimeouts=function(b){angular.forEach(c,function(b){a.cancel(b.timeout)}),b(null)},b}]),/*!
 *
 *	Services - CacheSvc
 *
 !*/
angular.module("gw2app").service("LocalStorageSvc",["$timeout",function(){"use strict";function a(a){return c.prefix+a}var b={},c={prefix:"gw2w2w::"};return b.put=function(b,c,d,e){var f=a(b),g=angular.isNumber(d)?d+Date.now():null,h=angular.toJson({value:c,expire:g});localStorage[f]=h,e(h)},b.get=function(c,d){var e=a(c),f=localStorage[e];if(f){var g=angular.fromJson(f);!angular.isNumber(g.expire)||g.expire>=Date.now()?d(g.value):b.del(c,d)}else d(null)},b.del=function(b,c){var d=a(b);localStorage.removeItem(d),c()},b.clear=function(a){localStorage.clear(),a(null)},b}]),/*!
 *
 *	Services - i18n
 *
 !*/
angular.module("gw2app").service("i18nSvc",[function(){"use strict";var a={};return a.liveScores={en:"Live Scores",es:"Resultados En Directo",de:"Live-Ergebnisse",fr:"Scores en direct"},a}]),/*!
 *
 *	Services - GW2ApiSvc
 *
 !*/
angular.module("gw2app").service("GW2ApiSvc",["$http","GW2DataSvc",function(a,b){"use strict";function c(b,e,f){s.remotesInProgress[b.cacheKey]=s.remotesInProgress[b.cacheKey]||!1,s.remotesInProgress[b.cacheKey]?setTimeout(c.bind(null,b,e,f),100):a.get(b.apiUrl).success(b.onRemoteData.bind(null,function(a){s.remotesInProgress[b.cacheKey]=!1,b.fnValidator(a)?e(null,a):d(b,e,f)})).error(d.bind(null,b,e,f))}function d(a,b,d){d=++d||1;var e=q(d);console.log("retry getter",e,a),setTimeout(c.bind(null,a,b,d),e)}function e(a,c,d){angular.forEach(d,function(c){c.id=parseInt(c.id),c.region=b.getRegion(c.id),c.slug=_.str.slugify(c.name.replace("ß","ss")),c.link=["",a,c.slug].join("/")}),c(d)}function f(a,c){var d=c.wvw_matches;angular.forEach(d,function(a){a.region=b.getRegion(a.wvw_match_id)}),a(d)}function g(a,c){var d={};async.forEach(c,function(a,c){a.type=b.getObjectiveType(a.name),d[a.id]=a,c()},a.bind(null,d))}function h(a,b){a(b)}function i(a,b){delete b.emblem,a(b)}function j(a){return a.length>=51}function k(a){if(!a||!a.guild_id&&!a.guild_name)throw"Either guild_id or guild_name must be passed";return o("guildDetails",a)}function l(a){return o("objectiveNames",a)}function m(a){return o("matches",a)}function n(a){if(!a||!a.match_id)throw"match_id is a required parameter";return o("matchDetails",a)}function o(a,b){if(!s.api.endPoints[a])throw"Invalid endpoint: "+a;var c=[s.api.protocol,s.api.hostname,s.api.endPoints[a],p(b)].join("");return c}function p(a){var b;return a&&Object.keys(a).length?(b=[],angular.forEach(a,function(a,c){b.push(c+"="+a)}),b="?"+b.join("&")):b="",b}function q(a){var b=6e4,c=1e3*(Math.pow(2,a)-1);c>b&&(c=b);var d=c/2;return _.random(d,c)}var r={},s={remotesInProgress:{},api:{protocol:"https://",hostname:"api.guildwars2.com",endPoints:{events:"/v1/events.json",eventNames:"/v1/event_names.json",eventDetails:"/v1/event_details.json",mapNames:"/v1/map_names.json",worldNames:"/v1/world_names.json",guildDetails:"/v1/guild_details.json",items:"/v1/items.json",itemDetails:"/v1/item_details.json",recipes:"/v1/recipes.json",recipeDetails:"/v1/recipe_details.json",continents:"/v1/continents.json",maps:"/v1/maps.json",mapFloor:"/v1/map_floor.json",objectiveNames:"/v1/wvw/objective_names.json",matches:"/v1/wvw/matches.json",matchDetails:"/v1/wvw/match_details.json"}}};return r.getWorlds=function(a,b){c({cacheKey:"worlds:"+a.lang,cacheTime:36e5,apiUrl:"/dist/cache/world_names."+a.lang+".json",onRemoteData:e.bind(null,a.lang),fnValidator:j},b)},r.getMatches=function(a,b){c({cacheKey:"matches",cacheTime:1e4,apiUrl:m(),onRemoteData:f,fnValidator:function(){return!0}},b)},r.getObjectives=function(a,b){c({cacheKey:"objectives",cacheTime:36e5,apiUrl:l(),onRemoteData:g,fnValidator:function(){return!0}},b)},r.getMatchDetails=function(a,b){c({cacheKey:"matchDetails:"+a.matchId,cacheTime:2e3,apiUrl:n({match_id:a.matchId}),onRemoteData:h,fnValidator:function(){return!0}},b)},r.getGuildDetails=function(a,b){c({cacheKey:"guild:"+a.guildId,cacheTime:2e3,apiUrl:k({guild_id:a.guild_id}),onRemoteData:i,fnValidator:function(){return!0}},b)},r}]),/*!
 *
 *	Services - GW2DataSvc
 *
 !*/
angular.module("gw2app").service("GW2DataSvc",[function(){"use strict";var a={regions:[{key:"NA",name:"North America"},{key:"EU",name:"Europe"}],langs:[{sort:1,slug:"en",label:"EN",href:"/en",name:"English"},{sort:2,slug:"de",label:"DE",href:"/de",name:"Deutsch"},{sort:3,slug:"es",label:"ES",href:"/es",name:"Español"},{sort:4,slug:"fr",label:"FR",href:"/fr",name:"Français"}],wvw:{colors:["red","blue","green"],worldsConfig:[{index:0,worldId:"red_world_id",team:"Red",color:"red",listClass:"list-group-item-danger",panelClass:"panel-danger"},{index:1,worldId:"blue_world_id",team:"Blue",color:"blue",listClass:"list-group-item-info",panelClass:"panel-info"},{index:2,worldId:"green_world_id",team:"Green",color:"green",listClass:"list-group-item-success",panelClass:"panel-success"}],commonNames:{en:",Overlook,Valley,Lowlands,Golanta Clearing,Pangloss Rise,Speldan Clearcut,Danelon Passage,Umberglade Woods,Stonemist Castle,Rogue's Quarry,Aldon's Ledge,Wildcreek Run,Jerrifer's Slough,Klovan Gully,Langor Gulch,Quentin Lake,Mendon's Gap,Anzalias Pass,Ogrewatch Cut,Veloka Slope,Durios Gulch,Bravost Escarpment,Garrison,Champion's Demense,Redbriar,Greenlake,Ascension Bay,Dawn's Eyrie,The Spiritholme,Woodhaven,Askalion Hills,Etheron Hills,Dreaming Bay,Victor's Lodge,Greenbriar,Bluelake,Garrison,Longview,The Godsword,Cliffside,Shadaran Hills,Redlake,Hero's Lodge,Dreadfall Bay,Bluebriar,Garrison,Sunnyhill,Faithleap,Bluevale Refuge,Bluewater Lowlands,Astralholme,Arah's Hope,Greenvale Refuge,Foghaven,Redwater Lowlands,The Titanpaw,Cragtop,Godslore,Redvale Refuge,Stargrove,Greenwater Lowlands,Temple of Lost Prayers,Battle's Hollow,Bauer's Estate,Orchard Overlook,Carver's Ascent,Carver's Ascent,Orchard Overlook,Bauer's Estate,Battle's Hollow,Temple of Lost Prayers,Carver's Ascent,Orchard Overlook,Bauer's Estate,Battle's Hollow,Temple of Lost Prayers".split(","),fr:",Belvédère,Vallée,Basses terres,Clairière de Golanta,Montée de Pangloss,Forêt rasée de Speldan,Passage Danelon,Bois d'Ombreclair,Château Brumepierre,Carrière des voleurs,Corniche d'Aldon,Piste du Ruisseau sauvage,Bourbier de Jerrifer,Petit ravin de Klovan,Ravin de Langor,Lac Quentin,Faille de Mendon,Col d'Anzalias,Percée de Gardogre,Flanc de Veloka,Ravin de Durios,Falaise de Bravost,Garnison,Fief du champion,Bruyerouge,Lac Vert,Baie de l'Ascension,Promontoire de l'aube,L'antre des esprits,Gentesylve,Collines d'Askalion,Collines d'Etheron,Baie des rêves,Pavillon du vainqueur,Vertebranche,Lac bleu,Garnison,Longuevue,L'Epée divine,Flanc de falaise,Collines de Shadaran,Rougelac,Pavillon du Héros,Baie du Noir déclin,Bruyazur,Garnison,Colline ensoleillée,Ferveur,Refuge de bleuval,Basses terres d'Eau-Azur,Astralholme,Espoir d'Arah,Refuge de Valvert,Havre gris,Basses terres de Rubicon,Bras du titan,Sommet de l'escarpement,Divination,Refuge de Valrouge,Bosquet stellaire,Basses terres d'Eau-Verdoyante,Temple des prières perdues,Vallon de bataille,Domaine de Bauer,Belvédère du Verger,Côte du couteau,Côte du couteau,Belvédère du Verger,Domaine de Bauer,Vallon de bataille,Temple des prières perdues,Côte du couteau,Belvédère du Verger,Domaine de Bauer,Vallon de bataille,Temple des prières perdues".split(","),es:",Mirador,Valle,Vega,Claro Golanta,Colina Pangloss,Claro Espeldia,Pasaje Danelon,Bosques Clarosombra,Castillo Piedraniebla,Cantera del Pícaro,Cornisa de Aldon,Pista Arroyosalvaje,Cenagal de Jerrifer,Barranco Klovan,Barranco Langor,Lago Quentin,Zanja de Mendon,Paso Anzalias,Tajo de la Guardia del Ogro,Pendiente Veloka,Barranco Durios,Escarpadura Bravost,Fuerte,Dominio del Campeón,Zarzarroja,Lagoverde,Bahía de la Ascensión,Aguilera del Alba,La Isleta Espiritual,Refugio Forestal,Colinas Askalion,Colinas Etheron,Bahía Onírica,Albergue del Vencedor,Zarzaverde,Lagoazul,Fuerte,Vistaluenga,La Hoja Divina,Despeñadero,Colinas Shadaran,Lagorrojo,Albergue del Héroe,Bahía Salto Aciago,Zarzazul,Fuerte,Colina Soleada,Salto de Fe,Refugio Valleazul,Tierras Bajas de Aguazul,Isleta Astral,Esperanza de Arah,Refugio de Valleverde,Refugio Neblinoso,Tierras Bajas de Aguarroja,La Garra del Titán,Cumbrepeñasco,Sabiduría de los Dioses,Refugio Vallerojo,Arboleda de las Estrellas,Tierras Bajas de Aguaverde,Templo de las Pelgarias,Hondonada de la Battalla,Hacienda de Bauer,Mirador del Huerto,Ascenso del Trinchador,Ascenso del Trinchador,Mirador del Huerto,Hacienda de Bauer,Hondonada de la Battalla,Templo de las Pelgarias,Ascenso del Trinchador,Mirador del Huerto,Hacienda de Bauer,Hondonada de la Battalla,Templo de las Pelgarias".split(","),de:",Aussichtspunkt,Tal,Tiefland,Golanta-Lichtung,Pangloss-Anhöhe,Speldan Kahlschlag,Danelon-Passage,Umberlichtung-Forst,Schloss Steinnebel,Schurkenbruch,Aldons Vorsprung,Wildbachstrecke,Jerrifers Sumpfloch,Klovan-Senke,Langor - Schlucht,Quentinsee,Mendons Spalt,Anzalias-Pass,Ogerwacht-Kanal,Veloka-Hang,Durios-Schlucht,Bravost-Abhang,Festung,Landgut des Champions,Rotdornstrauch,Grünsee,Bucht des Aufstiegs,Horst der Morgendammerung,Der Geisterholm,Wald - Freistatt,Askalion - Hügel,Etheron - Hügel,Traumbucht,Sieger - Hütte,Grünstrauch,Blausee,Festung,Weitsicht,Das Gottschwert,Felswand,Shadaran Hügel,Rotsee,Hütte des Helden,Schreckensfall - Bucht,Blaudornstrauch,Festung,Sonnenlichthügel,Glaubenssprung,Blautal - Zuflucht,Blauwasser - Tiefland,Astralholm,Arahs Hoffnung,Grüntal - Zuflucht,Nebel - Freistatt,Rotwasser - Tiefland,Die Titanenpranke,Felsenspitze,Götterkunde,Rottal - Zuflucht,Sternenhain,Grünwasser - Tiefland,Tempel der Verlorenen Gebete,Schlachten-Senke,Bauers Anwesen,Obstgarten Aussichtspunkt,Aufstieg des Schnitzers,Aufstieg des Schnitzers,Obstgarten Aussichtspunkt,Bauers Anwesen,Schlachten-Senke,Tempel der Verlorenen Gebete,Aufstieg des Schnitzers,Obstgarten Aussichtspunkt,Bauers Anwesen,Schlachten-Senke,Tempel der Verlorenen Gebete".split(",")},objectiveTypes:{1:{id:1,timer:1,value:35,type:"castle"},2:{id:2,timer:1,value:25,type:"keep"},3:{id:3,timer:1,value:10,type:"tower"},4:{id:4,timer:1,value:5,type:"camp"},5:{id:5,timer:0,value:0,type:"temple"},6:{id:6,timer:0,value:0,type:"hollow"},7:{id:7,timer:0,value:0,type:"estate"},8:{id:8,timer:0,value:0,type:"overlook"},9:{id:9,timer:0,value:0,type:"ascent"}},objectiveMeta:{9:{type:1,timer:1,d:0,n:0,s:0,w:0,e:0},1:{type:2,timer:1,d:1,n:1,s:0,w:0,e:0},17:{type:3,timer:1,d:1,n:1,s:0,w:1,e:0},20:{type:3,timer:1,d:1,n:1,s:0,w:0,e:1},18:{type:3,timer:1,d:1,n:0,s:1,w:1,e:0},19:{type:3,timer:1,d:1,n:0,s:1,w:0,e:1},6:{type:4,timer:1,d:1,n:0,s:0,w:1,e:0},5:{type:4,timer:1,d:1,n:0,s:0,w:0,e:1},2:{type:2,timer:1,d:1,n:0,s:1,w:0,e:1},15:{type:3,timer:1,d:1,n:0,s:1,w:1,e:0},22:{type:3,timer:1,d:1,n:0,s:1,w:0,e:1},16:{type:3,timer:1,d:1,n:1,s:0,w:1,e:0},21:{type:3,timer:1,d:1,n:1,s:0,w:0,e:1},7:{type:4,timer:1,d:1,n:0,s:1,w:0,e:0},8:{type:4,timer:1,d:1,n:0,s:0,w:0,e:1},3:{type:2,timer:1,d:1,n:1,s:0,w:0,e:0},11:{type:3,timer:1,d:1,n:0,s:1,w:1,e:0},13:{type:3,timer:1,d:1,n:0,s:1,w:0,e:1},12:{type:3,timer:1,d:1,n:1,s:0,w:1,e:0},14:{type:3,timer:1,d:1,n:1,s:0,w:0,e:1},10:{type:4,timer:1,d:1,n:1,s:0,w:0,e:0},4:{type:4,timer:1,d:1,n:0,s:0,w:0,e:1},23:{type:2,timer:1,d:1,n:1,s:0,w:0,e:0},27:{type:2,timer:1,d:1,n:0,s:0,w:1,e:0},31:{type:2,timer:1,d:1,n:0,s:0,w:0,e:1},30:{type:3,timer:1,d:1,n:1,s:0,w:1,e:0},28:{type:3,timer:1,d:1,n:1,s:0,w:0,e:1},29:{type:4,timer:1,d:1,n:1,s:0,w:0,e:0},58:{type:4,timer:1,d:1,n:1,s:0,w:1,e:0},60:{type:4,timer:1,d:1,n:1,s:0,w:0,e:1},25:{type:3,timer:1,d:1,n:0,s:1,w:1,e:0},26:{type:3,timer:1,d:1,n:0,s:1,w:0,e:1},24:{type:4,timer:1,d:1,n:0,s:1,w:0,e:0},59:{type:4,timer:1,d:1,n:0,s:1,w:1,e:0},61:{type:4,timer:1,d:1,n:0,s:1,w:0,e:1},37:{type:2,timer:1,d:1,n:1,s:0,w:0,e:0},33:{type:2,timer:1,d:1,n:0,s:0,w:1,e:0},32:{type:2,timer:1,d:1,n:0,s:0,w:0,e:1},38:{type:3,timer:1,d:1,n:1,s:0,w:1,e:0},40:{type:3,timer:1,d:1,n:1,s:0,w:0,e:1},39:{type:4,timer:1,d:1,n:1,s:0,w:0,e:0},52:{type:4,timer:1,d:1,n:1,s:0,w:1,e:0},51:{type:4,timer:1,d:1,n:1,s:0,w:0,e:1},35:{type:3,timer:1,d:1,n:0,s:1,w:1,e:0},36:{type:3,timer:1,d:1,n:0,s:1,w:0,e:1},34:{type:4,timer:1,d:1,n:0,s:1,w:0,e:0},53:{type:4,timer:1,d:1,n:0,s:1,w:1,e:0},50:{type:4,timer:1,d:1,n:0,s:1,w:0,e:1},46:{type:2,timer:1,d:1,n:1,s:0,w:0,e:0},44:{type:2,timer:1,d:1,n:0,s:0,w:1,e:0},41:{type:2,timer:1,d:1,n:0,s:0,w:0,e:1},47:{type:3,timer:1,d:1,n:1,s:0,w:1,e:0},57:{type:3,timer:1,d:1,n:1,s:0,w:0,e:1},56:{type:4,timer:1,d:1,n:1,s:0,w:0,e:0},48:{type:4,timer:1,d:1,n:1,s:0,w:1,e:0},54:{type:4,timer:1,d:1,n:1,s:0,w:0,e:1},45:{type:3,timer:1,d:1,n:0,s:1,w:1,e:0},42:{type:3,timer:1,d:1,n:0,s:1,w:0,e:1},43:{type:4,timer:1,d:1,n:0,s:1,w:0,e:0},49:{type:4,timer:1,d:1,n:0,s:1,w:1,e:0},55:{type:4,timer:1,d:1,n:0,s:1,w:0,e:1}},objectiveGroups:[{mapType:"Center",sortIndex:0,mapIndex:3,sections:[{label:"Castle",groupType:"neutral",objectives:[9]},{label:"Red Corner",groupType:"red",objectives:[1,17,20,18,19,6,5]},{label:"Blue Corner",groupType:"blue",objectives:[2,15,22,16,21,7,8]},{label:"Green Corner",groupType:"green",objectives:[3,11,13,12,14,10,4]}]},{mapType:"RedHome",sortIndex:1,mapIndex:0,sections:[{label:"North",groupType:"red",objectives:[37,33,32,38,40,39,52,51]},{label:"South",groupType:"neutral",objectives:[35,36,34,53,50]}]},{mapType:"BlueHome",sortIndex:2,mapIndex:1,sections:[{label:"North",groupType:"blue",objectives:[23,27,31,30,28,29,58,60]},{label:"South",groupType:"neutral",objectives:[25,26,24,59,61]}]},{mapType:"GreenHome",sortIndex:3,mapIndex:2,sections:[{label:"North",groupType:"green",objectives:[46,44,41,47,57,56,48,54]},{label:"South",groupType:"neutral",objectives:[45,42,43,49,55]}]}],mapObjectives:{}}};!function(){angular.forEach(a.wvw.objectiveGroups,function(b){var c=b.mapType;angular.forEach(b.sections,function(b){var d=b.label;angular.forEach(b.objectives,function(b){a.wvw.mapObjectives[b]={mapName:c,sectionName:d}})})})}();var b={objectiveTypeLookup:{castle:a.wvw.objectiveTypes[1],schloss:a.wvw.objectiveTypes[1],château:a.wvw.objectiveTypes[1],castillo:a.wvw.objectiveTypes[1],keep:a.wvw.objectiveTypes[2],feste:a.wvw.objectiveTypes[2],fort:a.wvw.objectiveTypes[2],fortaleza:a.wvw.objectiveTypes[2],tower:a.wvw.objectiveTypes[3],turm:a.wvw.objectiveTypes[3],tour:a.wvw.objectiveTypes[3],torre:a.wvw.objectiveTypes[3],"((temple of lost prayers))":a.wvw.objectiveTypes[5],"((battle's hollow))":a.wvw.objectiveTypes[6],"((bauer's estate))":a.wvw.objectiveTypes[7],"((orchard overlook))":a.wvw.objectiveTypes[8],"((carver's ascent))":a.wvw.objectiveTypes[9]}};return a.isValidLang=function(b){return _.some(a.langs,{slug:b})},a.getLang=_.memoize(function(b){return _.find(a.langs,{slug:b})}),a.getObjectiveType=function(c){return b.objectiveTypeLookup[c.toLowerCase()]||a.wvw.objectiveTypes[4]},a.getWorldsConfig=function(){return a.wvw.worldsConfig},a.getRegion=function(a){return 2===parseInt(a.toString().charAt(0))?"EU":"NA"},a}]),/*!
*
* Services - GW2Svc
*
!*/
angular.module("gw2app").service("GW2Svc",["$rootScope","LocalStorageSvc","MemCacheSvc","GW2DataSvc","GW2ApiSvc",function(a,b,c,d,e){function f(c,d){var f=36e5,g={};a.inProgress[c]=!0,async.each(l.data.langs,function(a,b){e.getWorlds({lang:a.slug},function(c,d){g[a.slug]=d,b()})},function(){delete a.inProgress[c],b.put(c,g,f,l.getWorlds.bind(null,d))})}function g(b,d){var e=null,f=null,g={};a.inProgress[b]=!0,l.getWorlds(function(h,i){async.each(Object.keys(i),function(a,b){async.each(i[a],function(b,c){g[b.id]=g[b.id]||{id:b.id},g[b.id][a]=b,c()},b)},function(){delete a.inProgress[b],c.put(b,g,e,f,l.getWorldsById.bind(null,d))})})}function h(c,d){var f=36e5;a.inProgress[c]=!0,e.getObjectives({},function(e,g){var h={};async.each(g,function(a,b){a.id=parseInt(a.id),a.type=l.data.getObjectiveType(a.name),g[h.id]=a,b()},function(){delete a.inProgress[c],b.put(c,g,f,l.getObjectives.bind(null,d))})})}function i(b,d){var f=4e3,g=null;a.inProgress[b]=!0,e.getMatches({},function(e,h){delete a.inProgress[b],c.put(b,h,f,g,l.getMatches.bind(null,d))})}function j(b,d,f){var g=2e3,h=null;a.inProgress[d]=!0,e.getMatchDetails({matchId:b},function(e,i){delete a.inProgress[d],c.put(d,i,g,h,l.getMatchDetails.bind(null,b,f))})}function k(b,d,f){var g=36e5,h=null;a.inProgress[d]=!0,e.getGuildDetails({guild_id:b},function(e,i){delete a.inProgress[d],c.put(d,i,g,h,l.getGuildDetails.bind(null,b,f))})}console.log("********************"),console.log("GW2Svc Invoked"),console.log("GW2DataSvc",d),console.log("GW2ApiSvc",e),console.log("********************");var l={};l.data=d;return a.inProgress=a.inProgress||{},l.initWorldData=function(a){console.log("initWorldData()"),async.series([l.getWorlds,l.getWorldsById],function(){console.log("initWorldData() complete"),a()})},l.getWorlds=function(c){var d="worlds";b.get(d,function(b){b?c(null,b):angular.isDefined(a.inProgress[d])?setTimeout(l.getWorlds.bind(null,c),100):f(d,c)})},l.getWorldsById=function(b){var d="worldsById";c.get(d,function(c,e){e?b(null,e):angular.isDefined(a.inProgress[d])?setTimeout(l.getWorldsById.bind(null,b),100):g(d,b)})},l.getWorldsByLang=function(a,b){l.getWorlds(function(c,d){b(null,d[a])})},l.getWorldById=function(a,b){l.getWorldsById(function(c,d){b(null,d[a])})},l.getWorldBySlug=function(a,b,c){l.getWorldsByLang(b,function(b,d){async.detect(d,function(b,c){c(b.slug===a)},c.bind(null,null))})},l.getObjectives=function(c){var d="objectives";b.get(d,function(b){b?c(null,b):angular.isDefined(a.inProgress[d])?setTimeout(l.getObjectives.bind(null,c),100):h(d,c)})},l.getMatches=function(b){var d="matches";c.get(d,function(c,e){e?b(null,e):angular.isDefined(a.inProgress[d])?setTimeout(l.getMatches.bind(null,b),100):i(d,b)})},l.getNextMatchReset=function(a,b){var c=_.pluck(a,"end_time"),d=_.map(c,function(a){return Date.parse(a)}),e=Math.min.apply(Math,d);b(e)},l.getMatchDetails=function(b,d){var e="matchDetails"+b;c.get(e,function(c,f){f?d(null,f):angular.isDefined(a.inProgress[e])?setTimeout(l.getMatchDetails.bind(null,b,d),100):j(b,e,d)})},l.getGuildDetails=function(b,d){var e="guild-"+b;c.get(e,function(c,f){f?d(null,f):angular.isDefined(a.inProgress[e])?setTimeout(l.getGuildDetails.bind(null,d),100):k(b,e,d)})},l}]),/*!
*
*	Controllers - App
*
!*/
angular.module("gw2app").controller("AppCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","$interval","GW2Svc",function(a,b,c,d,e,f,g){function h(b,c){b.lang&&!a.active.lang?p("Invalid Language:"+b.lang+"\nRedirecting to root","/en",c):b.worldSlug&&!a.active.world?p("Invalid World:"+b.worldSlug+"\nRedirecting to root","/en",c):a.active.lang&&a.active.world?(a.appMode="tracker",c()):a.active.lang?(a.appMode="overview",c()):(a.appMode="error",c())}function i(b){a.gw2={regions:g.data.regions,langs:g.data.langs,wvw:g.data.wvw},a.initTime=Date.now(),a.active=a.active||{},a.matchDetails=a.matchDetails||{},a.scores=a.scores||{},a.scoreDiff={},a.matchId=a.matchId||null,a.prevMatchId=a.prevMatchId||null,console.log("matchId",a.matchId),console.log("prevMatchId",a.prevMatchId),a.$$phase||a.$apply(),b()}function j(a){g.initWorldData(function(){async.parallel([k,l],function(){console.log("__initWorldData complete"),a()})})}function k(b){g.getWorlds(function(c,d){a.worlds=d,b()})}function l(b){g.getWorldsById(function(c,d){a.worldsById=d,b()})}function m(b){g.getMatches(function(c,d){a.matches=d,g.getNextMatchReset(d,function(c){var d=c-Date.now(),f=Math.round(d/1e3/60);console.log("Next reset in ",f);var g=8;512e3>d&&(g=2,console.log("Reset Soon!!!",d));var h=a.getTimeout(g);a.timers.matches=e(m,h),(b||angular.noop)()})})}function n(b,c){a.active.lang=g.data.getLang(b.lang),console.log("$scope.active.lang",a.active.lang),c()}function o(b,c){console.log("__setActiveWorld"),angular.isDefined(b.worldSlug)&&angular.isDefined(a.active.lang)?g.getWorldBySlug(b.worldSlug,a.active.lang.slug,function(b,d){a.active.world=d,console.log("$scope.active.world",a.active.world),c()}):c()}function p(a,b,c){alert(a),console.log(a),d.path(b),c()}a.getMatchDetails=function(b,c,d){var f="matchDetails"+c;g.getMatchDetails(c,function(g,h){a.timers[f]=e(a.getMatchDetails.bind(null,b,c),a.getTimeout(b)),a.matchDetails[c]=h,a.scores[c]=h.scores,a.$$phase||a.$apply(),(d||angular.noop)()})},a.getTimeout=function(a){var b=1e3*Math.pow(2,a),c=1e3*Math.pow(2,a+1),d=_.random(b,c);return d},a.timers=a.timers||{},a.intervals=a.intervals||{},a.$on("$destroy",function(){angular.forEach(a.timers,function(a){e.cancel(a)}),angular.forEach(a.intervals,function(a){f.cancel(a)})}),a.setPageTitle=function(a,c){b.pageTitle=a,c()},a.requestsInProgress=_.throttle(function(){return!!Object.keys(b.inProgress).length},100),function(){var b=this;return console.log("AppCtrl Starting"),async.auto({initScope:i,initWorldData:j,initMatchData:["initScope",m],setActiveLang:n.bind(null,c),setActiveWorld:["initScope","initWorldData","setActiveLang",o.bind(null,c)],determineMode:["setActiveWorld",h.bind(null,c)]},function(){a.$$phase||a.$apply(),console.log("AppCtrl Initialized"),a.$broadcast("appInit")}),b}()}]),/*!
 *
 *	Controllers - Overview
 *
 !*/
angular.module("gw2app").controller("OverviewCtrl",["$scope","$timeout","GW2Svc","i18nSvc",function(a,b,c,d){"use strict";function e(b){var c=_.pluck(a.matches,"wvw_match_id");async.each(c,function(b,c){g(b),a.getMatchDetails(i,b,c)},b)}function f(b){var c=["GuildWars2 WvW",d.liveScores[a.active.lang.slug]];"en"!==a.active.lang.slug&&c.push("("+a.active.lang.name+")"),a.setPageTitle(c.join(" "),b)}function g(b){a.$watch(function(){return a.scores[b]},h.bind(null,b))}function h(b,c,d){c&&d&&(a.scoreDiff[b]=[c[0]-d[0],c[1]-d[1],c[2]-d[2]])}console.log("\nAPP MODE :: Overview\n");var i=2;a.$on("appInit",function(){console.log("OverviewCtrl Starting"),async.auto({initMatchScores:e,setPageTitle:f},function(){console.log("OverviewCtrl Ready")})}),a.pieChartInfo=function(){return{scores:a.scores[match.wvw_match_id],size:60,strokeWidth:2}}}]),/*!
 *
 *	Controllers - TrackerCtrl
 *
 !*/
angular.module("gw2app").controller("TrackerCtrl",["$scope","$anchorScroll","$window","$interval","$timeout","GW2Svc","i18nSvc",function(a,b,c,d,e,f,g){"use strict";function h(){a.$watch(function(){return a.matchDetails[a.active.matchId]},function(b){a.active.matchDetails=b})}function i(b){var c=a.active.world.id;async.detect(a.matches,function(a,b){b(a.blue_world_id===c||a.green_world_id===c||a.red_world_id===c)},function(c){a.matchId&&(a.prevMatchId=a.matchId),a.active.match=c,a.active.matchId=c.wvw_match_id,a.matchId=c.wvw_match_id,b()})}function j(b){a.logFilters={map:"all",captures:!0,claims:!0},a.moment=c.moment,a.timersAccurate=!1,C(),o(),m(),a.mapNamesByType={Center:"Eternal Battlegrounds",RedHome:a.matchWorldsByColor.red[a.active.lang.slug].name,BlueHome:a.matchWorldsByColor.blue[a.active.lang.slug].name,GreenHome:a.matchWorldsByColor.green[a.active.lang.slug].name},console.log("$scope.matchWorldsByColor",a.matchWorldsByColor),console.log("$scope.mapNamesByType",a.mapNamesByType),angular.equals(a.prevMatchId,a.active.matchId)?(a.objectivesState=a.objectivesState,a.timeline=a.timeline,a.guilds=a.guilds,a.matchGuilds=a.matchGuilds):(a.objectivesState=null,a.timeline=[],a.guilds={},a.matchGuilds={}),console.log("Scope Inited"),b()}function k(b){var c=[a.active.world.name,"@","GuildWars2 WvW",g.liveScores[a.active.lang.slug]];"en"!==a.active.lang.slug&&c.push("("+a.active.lang.name+")"),a.setPageTitle(c.join(" "),b)}function l(b){a.matchWorlds=[a.worldsById[a.active.match.red_world_id],a.worldsById[a.active.match.blue_world_id],a.worldsById[a.active.match.green_world_id]],a.matchWorldsByColor={red:a.worldsById[a.active.match.red_world_id],blue:a.worldsById[a.active.match.blue_world_id],green:a.worldsById[a.active.match.green_world_id]},b()}function m(){var b={castles:0,keeps:0,towers:0,camps:0,tick:0};a.holdings={red:_.clone(b),blue:_.clone(b),green:_.clone(b)}}function n(b,c,d){if(b&&!angular.equals(b,c)){var e=r(b);m(),_.each(e,function(b){var c=a.gw2.wvw.objectiveMeta[b.id];if(c){var d=a.gw2.wvw.objectiveTypes[c.type],e=b.owner.toLowerCase();1===c.type?a.holdings[e].castles++:2===c.type?a.holdings[e].keeps++:3===c.type?a.holdings[e].towers++:4===c.type&&a.holdings[e].camps++,a.holdings[e].tick+=d.value}})}d()}function o(){var b=document.createElement("audio");b.setAttribute("src","/dist/audio/beep-27.mp3"),a.audioEnabled=!1,a.toggleAudio=function(){a.audioEnabled=!a.audioEnabled},a.playNotificationSound=_.throttle(function(){a.audioEnabled&&b.play()},500)}function p(a,b){async.parallel([v.bind(null,a),s.bind(null,a,b),n.bind(null,a,b)])}function q(b){f.getObjectives(function(c,d){a.objectives=d,b()})}function r(a){var b=_.flatten(_.pluck(a.maps,"objectives")),c={};return angular.forEach(b,function(a){c[a.id]=a}),c}function s(b,c,d){b||c||d(),!b||c||a.objectivesState||t(b,d),b&&c&&F(b,c,d)}function t(b,c){var d=(D(),r(b));angular.forEach(d,function(b){b.lastCaptured=b.lastCaptured||a.initTime,b.buffRemaining=b.lastCaptured+3e5,b.owner_guild&&(b.lastClaimed=b.lastClaimed||_.random(b.lastCaptured-6e5,b.lastCaptured),x(b.lastCaptured,b.owner_guild,b.id))}),a.objectivesState=d,c()}function u(b,c,d){var e=r(b),g=r(c),h=D();angular.forEach(a.objectives,function(b){var c=a.gw2.wvw.objectiveMeta[b.id];if(c&&c.timer){var d=(c?a.gw2.wvw.objectiveTypes[c.type]:null,a.objectivesState[b.id]),i=g[b.id],j=e[b.id],k=i.owner!==j.owner,l=i.owner_guild!==j.owner_guild,m=!!j.owner_guild;if(k||l){var n=f.data.wvw.commonNames[a.active.lang.slug][b.id];k&&(console.log(Date.now(),"newOwner"),d.owner=j.owner,d.prevOwner=i.owner,d.lastCaptured=h,d.buffRemaining=d.lastCaptured+3e5,delete d.owner_guild,y(h,"newOwner",j)),l&&(d.owner_guild=j.owner_guild,m?(console.log(Date.now(),"newClaimer"),d.lastClaimed=h,y(h,"newClaimer",j),x(h,j.owner_guild,j.id)):console.log(Date.now(),"************ dropClaimer")),a.playNotificationSound(),console.log(Date.now(),n,d,i,j)}}}),d()}function v(b,c){if(b){var d=r(b),e=_.pluck(d,"owner_guild");e=_.without(_.uniq(e),void 0);var f=Object.keys(a.guilds),g=_.difference(e,f);async.each(g,w,c)}else c()}function w(b,c){f.getGuildDetails(b,function(d,e){a.guilds[b]=e,c()})}function x(b,c,d){var e=a.active.match.wvw_match_id,f=a.matchGuilds[e]=a.matchGuilds[e]||{};f[c]||(f[c]={id:c,claims:[],latestClaim:b}),f[c].claims.push({id:d,timestamp:b}),angular.forEach(f[c].claims,function(a){f[c].latestClaim=Math.max(f[c].latestClaim,a.timestamp)}),f[c].latestClaimText=moment(f[c].latestClaim).format("dddd, MMMM Do YYYY, h:mm:ss a")}function y(b,c,d){var e=_.cloneDeep(d);a.timeline.push({timestamp:b,type:c,objective:e,twitter:moment(b).twitter()})}function z(){async.parallel([A,B],angular.noop)}function A(b){var c=D();angular.forEach(a.objectivesState,function(b){var d=!!a.objectives[b.id].type.timer;d&&b.buffRemaining&&(b.buffRemaining=b.lastCaptured+3e5-c,b.buffRemaining<=0&&delete b.buffRemaining)}),b()}function B(b){a.timeline&&a.timeline.length?async.map(a.timeline,function(a,b){a.twitter=moment(a.timestamp).twitter(),b(null,a)},b):b()}function C(){var b=Date.now()-a.initTime,c=b>3e5;c?(console.log("Timers now accurate"),a.timersAccurate=!0):a.timers.__waitForAccurateTimers=e(C,1e3)}function D(){return 1e3*Math.round(Date.now()/1e3)}console.log("\nAPP MODE :: Tracker\n");var E=1;a.gotoGuild=function(a){$location.hash(a),b()},a.highlightObjective=function(a){$("#objective"+a).addClass("highlight")},a.deHighlightObjective=function(a){$("#objective"+a).removeClass("highlight")},a.getDirectionArrow=function(b){var c=a.gw2.wvw.objectiveMeta[b],d=["/dist/img/min/arrow"];return c.n?d.push("north"):c.s&&d.push("south"),c.w?d.push("west"):c.e&&d.push("east"),d.join("-")},a.$on("appInit",function(){console.log("TrackerCtrl Starting"),async.auto({setActiveMatch:i,setMatchWorlds:l,setObjectives:q,initScope:["setActiveMatch",j],setPageTitle:["setActiveMatch",k],getMatchDetails:["initScope",function(b){a.getMatchDetails(E,a.active.matchId,b)}],watchMatchDetails:["getMatchDetails",function(b){a.$watch("active.matchDetails",p),b()}]},function(){console.log("TrackerCtrl Ready"),h()})});var F=_.throttle(u,100);a.intervals.__updateTimers=d(z,1e3)}]);
//# sourceMappingURL=app.min.map